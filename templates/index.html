<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-default/index.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.1/css/bulma.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <title>HoNNeT - who wins on Heroes of Newerth!</title>
  </head>
  <body>
    <nav class="nav">
      <div class="nav-left">
      </div>

      <div class="nav-center">
        <a class="nav-item">
          <span class="icon">
            <i class="fa fa-github"></i>
          </span>
        </a>
        <a class="nav-item">
          <span class="icon">
            <i class="fa fa-twitter"></i>
          </span>
        </a>
      </div>

      <!-- This "nav-toggle" hamburger menu is only visible on mobile -->
      <!-- You need JavaScript to toggle the "is-active" class on "nav-menu" -->
      <span class="nav-toggle">
        <span></span>
        <span></span>
        <span></span>
      </span>

      <!-- This "nav-menu" is hidden on mobile -->
      <!-- Add the modifier "is-active" to display it on mobile -->
      <div class="nav-right nav-menu">

        <span class="nav-item">
          <a class="button" >
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
            <span>Tweet</span>
          </a>
          <a class="button is-primary">
            <span class="icon">
              <i class="fa fa-download"></i>
            </span>
            <span>Download</span>
          </a>
        </span>
      </div>
    </nav>
    <!-- <div id="app"> -->
    <!-- <el-button @click="visible = true">Button</el-button> -->
    <!-- <el-dialog v-model="visible" title="Hello world"> -->
    <!-- <p>Try Element</p> -->
    <!-- </el-dialog> -->
    <!-- </div> -->
    <section class="hero is-info is-bold">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">
            HoNNeT
          </h1>
          <h2 class="subtitle">
            Predicts which team would win given heroes of both teams (driven by deep
            learning algorithms)
          </h2>
        </div>
      </div>
    </section>
    <div class="container is-fluid box" id="app">
      <form action="/" method="GET">
        <div class="notification is-primary" v-if="true">Add some heroes then click
          "Update Prediction" at the bottom. (Works best when predicting 5v5
          matches)</div>
        <div class="notification">
          <div class="columns">
            <div class="column">
              <p class="notification is-success box">
              Legion
              </p>
              <ul class="box">
                <p class="control">
                <span class="select is-large">
                  <select v-model.number="legionId">
                    <option value="0">Select a Hero</option>
                    {% for key, val in heroes_id_dict.items() %}
                    <option value="{{ val }}">{{ key }}</option>
                    {% endfor %}
                  </select>
                </span>
                <a class="button is-info is-large" :disabled="legionId == 0 ||
                   legionId in legion"
                  @click.prevent="addHero(false)">Add to the team</a>
                </p>
                <template v-if="legion.length && hellbourne.length && !dirty">
                  Winning Chance: {{ legion_prob }} %
                  <progress class="progress is-success is-large"
                            value="{{ legion_prob }}"
                            max="100">{{ legion_prob }}</progress>
                </template>
                <li v-for="hero_id of legion">
                  <div class="notification">
                    <button class="delete" @click.prevent="removeHero(hero_id, false)"></button>
                    {% raw %}
                    {{ id_to_name(hero_id) }}
                    {% endraw %}
                  </div>
                </li>
              </ul>
            </div>
            <div class="column is-danger">
              <p class="notification is-danger">
              Hellbourne
              </p>
              <ul class="box">
                <p class="control">
                <span class="select is-large">
                  <select v-model.number="hellbourneId">
                    <option value="0">Select a Hero</option>
                    {% for key, val in heroes_id_dict.items() %}
                    <option value="{{ val }}">{{ key }}</option>
                    {% endfor %}
                  </select>
                </span>
                <a class="button is-info is-large" :disabled="hellbourneId == 0
                || hellbourneId in hellbourne"
                  @click.prevent="addHero(true)">Add to the team</a>
                </p>
                <template v-if="legion.length && hellbourne.length && !dirty">
                Winning Chance: {{ hellbourne_prob }} %
                <progress class="progress is-danger is-large"
                          value="{{ hellbourne_prob }}"
                          max="100">{{ hellbourne_prob }}</progress>
                </template>
                <li v-for="hero_id of hellbourne">
                  <div class="notification">
                    <button class="delete" @click.prevent="removeHero(hero_id, true)"></button>
                    {% raw %}
                    {{ id_to_name(hero_id) }}
                    {% endraw %}
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="columns">
            <div class="column">
              <center>
                <a class="button is-large is-info" v-if="dirty"
                  @click.prevent="updatePrediction()">Update
                  Prediction</a>
                <section class="hero is-warning" v-if="legion.length &&
                  hellbourne.length && !dirty">
                  <div class="hero-body">
                    <div class="container">
                      <h1 class="title">
                        Conclusion
                      </h1>
                    </div>
                  </div>
                  Who would win? <strong>{{ winner }}</strong><br>
                  Chance that {{ loser }} would concede: <strong>{{
                    concede_prob }} %</strong><br>
                  The game would end in <strong>{{ lasting_minutes }}</strong> minutes.
                </section>
              </center>
            </div>
          </div>
        </div>
      </form>
    </div>
    <footer class="footer">
      <div class="container">
        <div class="content has-text-centered">
          <p>
          <b>Disclaimer</b>: Don't take it too serious. The system is fed and learned from only ~90,000 random HoN matches.
          </p>
          <p>
          <strong>HoNNeT</strong> by <a href="https://github.com/off99555">off99555</a>. The source code is licensed
          <a href="https://github.com/off99555/HoNNeT/blob/master/LICENSE">Apache-2.0</a>.                    </p>
          <p>
          <a class="icon" href="https://github.com/off99555/HoNNeT">
            <i class="fa fa-github"></i>
          </a>
          </p>
        </div>
      </div>
    </footer>
  </body>
  <!-- import Vue before Element -->
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <!-- import JavaScript -->
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script>
  const id2name_dict = {
    {% for key, val in heroes_id_dict.items() %}
    {{val}}: '{{key}}',
    {% endfor %}
  }
  const vm = new Vue({
    el: '#app',
    data() {
      return {
        legion: [
        {% for hero_id in legion %}
          {{ hero_id }},
        {% endfor %}
        ],
        hellbourne: [
        {% for hero_id in hellbourne %}
          {{ hero_id }},
        {% endfor %}
        ],
        legionId: 0,
        hellbourneId: 0,
        dirty: false
      }
    },
    methods: {
      id_to_name,
      removeHero: function(id, hell) {
        side = hell ? this.hellbourne : this.legion
        index = side.indexOf(id)
        side.splice(index, 1)
        this.dirty = true
      },
      addHero: function(hell) {
        side = hell ? this.hellbourne : this.legion
        id = hell ? this.hellbourneId : this.legionId
        if (!id)
          return
        side.push(id)
        this.dirty = true
      },
      updatePrediction: function() {
        url = '?' + this.GETParams
        loadUrl(url)
      }
    },
    computed: {
      GETParams: function() {
        obj = {'legion': this.legion, 'hellbourne': this.hellbourne}
        return serialize(obj)
      }
    },
    watch: {
      legionId: function() {
        // this.addHero(this.legionId, false)
      },
      hellbourneId: function() {
        // this.addHero(this.hellbourneId, true)
      }
    }
  })
  function id_to_name(id) {
    return id2name_dict[id]
  }
  function serialize(obj) {
    var str = [];
    for(var p in obj)
      if (obj.hasOwnProperty(p)) {
        str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
      }
    return str.join("&");
  }
  function loadUrl(newLocation) {
    window.location.href = newLocation;
  }
  </script>
</html>
